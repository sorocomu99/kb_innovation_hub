<!--
 파일명     : investment.html
 관련자바   : InvestmentController
 화면명     : 국내 프로그램 - 투자 그래프 관리
 설명       : 국내 프로그램 - 투자 그래프 조회, 등록, 수정 처리
 최초개발일 : 2024.11.11
 최초개발자 : 양윤지
 ==========================================================
   수정일            수정자           설명
 ==========================================================
-->
<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragment/config :: configFragment}"></head>
<body>
    <div class="wrap">
        <app-header></app-header>
        <main class="main">
            <div class="container">
                <div class="row">
                    <div class="col">
                        <div class="paper">
                            <h2 class="h4">국내 프로그램 - 투자 그래프 관리</h2>
                            <div class="mt-4">
                                <form th:action="@{/investment/save}" method="post" name="investment_form">
                                    <input type="hidden" name="menu_id" th:value="${menuId}"/>
                                    <input type="hidden" th:value="${investment?.graph_sn}" name="graph_sn"/>
                                    <table class="table table-bordered align-middle">
                                        <tbody>
                                            <tr>
                                                <th class="bg-light" style="width:18%">기준년월</th>
                                                <td>
                                                    <input type="text" class="form-control" name="crtr_ym" th:value="${investment?.crtr_ym}" placeholder=" ex) 2024년 10월 기준">
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <table class="table table-bordered align-middle">
                                        <tbody>
                                            <tr>
                                                <th class="bg-light text-center" colspan="2" style="width:20%">그래프 1</th>
                                                <th class="bg-light text-center" colspan="2" style="width:20%">그래프 2</th>
                                                <th class="bg-light text-center" colspan="2" style="width:20%">그래프 3</th>
                                                <th class="bg-light text-center" colspan="2" style="width:20%">그래프 4</th>
                                                <th class="bg-light text-center" colspan="2" style="width:20%">그래프 5</th>
                                            </tr>
                                            <tr>
                                                <th class="bg-light" style="width:8%">연도</th>
                                                <td>
<!--                                                    <input type="number" class="form-control" name="graph1_yr" th:value="${select?.graph1_yr}" placeholder=" ex) 2024">-->
                                                    <select class="form-select" name="graph1_yr">
                                                        <option value="" th:disabled th:hidden="true">-선택-</option>
                                                        <option th:each="i : ${#numbers.sequence(#dates.year(#dates.createNow()) - 5, #dates.year(#dates.createNow()) + 5)}" th:value="${i}" th:text="${i}" th:selected="${investment?.graph1_yr} == ${i}"></option>
                                                    </select>
                                                </td>
                                                <th class="bg-light" style="width:8%">연도</th>
                                                <td>
<!--                                                    <input type="number" class="form-control" name="graph2_yr" th:value="${select?.graph2_yr}" placeholder=" ex) 2024">-->
                                                    <select class="form-select" name="graph2_yr">
                                                        <option value="" th:disabled th:hidden="true">-선택-</option>
                                                        <option th:each="i : ${#numbers.sequence(#dates.year(#dates.createNow()) - 5, #dates.year(#dates.createNow()) + 5)}" th:value="${i}" th:text="${i}" th:selected="${investment?.graph2_yr} == ${i}"></option>
                                                    </select>
                                                </td>
                                                <th class="bg-light" style="width:8%">연도</th>
                                                <td>
<!--                                                    <input type="number" class="form-control" name="graph3_yr" th:value="${select?.graph3_yr}" placeholder=" ex) 2024">-->
                                                    <select class="form-select" name="graph3_yr">
                                                        <option value="" th:disabled th:hidden="true">-선택-</option>
                                                        <option th:each="i : ${#numbers.sequence(#dates.year(#dates.createNow()) - 5, #dates.year(#dates.createNow()) + 5)}" th:value="${i}" th:text="${i}" th:selected="${investment?.graph3_yr} == ${i}"></option>
                                                    </select>
                                                </td>
                                                <th class="bg-light" style="width:8%">연도</th>
                                                <td>
<!--                                                    <input type="number" class="form-control" name="graph4_yr" th:value="${select?.graph4_yr}" placeholder=" ex) 2024">-->
                                                    <select class="form-select" name="graph4_yr">
                                                        <option value="" th:disabled th:hidden="true">-선택-</option>
                                                        <option th:each="i : ${#numbers.sequence(#dates.year(#dates.createNow()) - 5, #dates.year(#dates.createNow()) + 5)}" th:value="${i}" th:text="${i}" th:selected="${investment?.graph4_yr} == ${i}"></option>
                                                    </select>
                                                </td>
                                                <th class="bg-light" style="width:8%">연도</th>
                                                <td>
<!--                                                    <input type="number" class="form-control" name="graph5_yr" th:value="${select?.graph5_yr}" placeholder=" ex) 2024">-->
                                                    <select class="form-select" name="graph5_yr">
                                                        <option value="" th:disabled th:hidden="true">-선택-</option>
                                                        <option th:each="i : ${#numbers.sequence(#dates.year(#dates.createNow()) - 5, #dates.year(#dates.createNow()) + 5)}" th:value="${i}" th:text="${i}" th:selected="${investment?.graph5_yr} == ${i}"></option>
                                                    </select>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th class="bg-light">기업 수</th>
                                                <td><input type="number" class="form-control" name="graph1_nocs" th:value="${investment?.graph1_nocs}" placeholder=" ex) 123"></td>
                                                <th class="bg-light">기업 수</th>
                                                <td><input type="number" class="form-control" name="graph2_nocs" th:value="${investment?.graph2_nocs}" placeholder=" ex) 123"></td>
                                                <th class="bg-light">기업 수</th>
                                                <td><input type="number" class="form-control" name="graph3_nocs" th:value="${investment?.graph3_nocs}" placeholder=" ex) 123"></td>
                                                <th class="bg-light">기업 수</th>
                                                <td><input type="number" class="form-control" name="graph4_nocs" th:value="${investment?.graph4_nocs}" placeholder=" ex) 123"></td>
                                                <th class="bg-light">기업 수</th>
                                                <td><input type="number" class="form-control" name="graph5_nocs" th:value="${investment?.graph5_nocs}" placeholder=" ex) 123"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div class="button-container">
                                        <a href="javascript:" class="btn btn-outline-primary">미리보기</a>
                                        <button type="button" class="btn btn-primary" onclick="confirmMsg()">저장하기</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script th:src="@{/js/admin.js}"></script>

    <script th:inline="javascript">
        // 페이지 로드 시 실행
        window.onload = function () {
            // 페이지 로드 시 메시지 확인 및 알림 표시
            // 수정 및 등록 시 띄울 알림창
            const msg = /*[[${msg}]]*/ '';
            if (msg) alert(msg);

            // 만약 메뉴 해당 아이디의 value와 화면의 value가 일치하면
            // 메뉴를 활성화 시킴(삭제 금지)
            var menu_id = $("#menu_id_" + $("input[name=menu_id]").val());
            if(menu_id.val() == $("input[name=menu_id]").val()) {
                menu_id.parent().parent().prev().children().removeClass("collapsed");
                menu_id.parent().parent().addClass("show");
                menu_id.next().addClass("active");
            }

            // 현재 년도 기준으로 셀렉트 박스 선택 되게 하기
            // 만약 값이 없으면 세팅(등록)
            var year = new Date().getFullYear();
            var select = document.getElementsByName("graph1_yr");
            var options = select[0].options;
            // 옵션들 중에서 해당 되는 년도를 선택
            for(var i = 0; i < options.length; i++) {
                if(options[i].value == String(year) && options[options.selectedIndex].value == '') {
                    options[i].selected = true;
                }
            }
        };

        // 컨펌 메시지 띄우는 함수
        function confirmMsg() {
            // 기준년월 입력 확인
            var crtr_ym = $('input[name=crtr_ym]').val();
            if(crtr_ym.trim() == "") {
                alert("기준년월을 입력 해 주세요.");
                return false;
            }

            // 그래프 1의 기업 수 입력 확인
            var graph1_nocs = $('input[name=graph1_nocs]').val();
            if(graph1_nocs.trim() == "") {
                alert("기업 수를 입력 해 주세요.");
                return false;
            }

            // 만약 input의 값이 0이 아니면
            var graph2_nocs = $('input[name=graph2_nocs]').val();
            if(graph2_nocs.trim() == "") {
                $('input[name=graph2_nocs]').val(0);
            }

            // 만약 input의 값이 0이 아니면
            var graph3_nocs = $('input[name=graph3_nocs]').val();
            if(graph3_nocs.trim() == "") {
                $('input[name=graph3_nocs]').val(0);
            }

            // 만약 input의 값이 0이 아니면
            var graph4_nocs = $('input[name=graph4_nocs]').val();
            if(graph4_nocs.trim() == "") {
                $('input[name=graph4_nocs]').val(0);
            }

            // 만약 input의 값이 0이 아니면
            var graph5_nocs = $('input[name=graph5_nocs]').val();
            if(graph5_nocs.trim() == "") {
                $('input[name=graph5_nocs]').val(0);
            }

            let result = confirm("저장 하시겠습니까?");
            if(!result) {
                return false;
            } else {
                var graph_sn = $("input[name=graph_sn]").val();
                // PK 값이 비어있으면 기본 값 0 세팅
                if(graph_sn == "") {
                    $("input[name=graph_sn]").val(0);
                }
                // 폼 태그 서브밋 보내기
                f=document.investment_form;
                f.submit();
            }
        }
    </script>
    
</body>
</html>